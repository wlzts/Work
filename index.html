<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work-log å·¥ä½œè®°å½•ç³»ç»Ÿ</title>
  <style>
    /* å…¨å±€æ ·å¼ - é€‚é…åˆåŠ›ä¼ä¸šå“ç‰Œé£æ ¼ï¼ˆåˆåŠ›çº¢+è“è‰²+é»„è‰²ç‚¹ç¼€ï¼‰ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: #f5f7fa;
      color: #2c3e50;
      line-height: 1.6;
      overflow-x: hidden;
      display: flex;
      min-height: 100vh;
    }

    /* Logoæ ·å¼ - åˆåŠ›ä¼ä¸šé£æ ¼ */
    .logo-container {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px 0;
      border-bottom: 2px solid #e8eaf6;
    }
    .logo-image {
      width: 220px;
      height: auto;
      display: block;
      margin: 0 auto;
      transition: transform 0.3s ease;
    }
    .logo-image:hover {
      transform: scale(1.05);
    }

    /* åŠ è½½åŠ¨ç”» */
    .loader {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #d32f2f;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* é€šçŸ¥æç¤º - åˆåŠ›ä¼ä¸šé£æ ¼ */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 14px 22px;
      background: #2c3e50;
      color: white;
      border-radius: 6px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
      z-index: 9999;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast.success {
      background: #2ecc71;
    }

    .toast.error {
      background: #e74c3c;
    }

    .toast.info {
      background: #de1f1f; /* åˆåŠ›çº¢é€šçŸ¥ */
    }

    /* ä¾§è¾¹æ æ ·å¼ - åˆåŠ›ä¼ä¸šé£æ ¼ */
    .sidebar {
      width: 280px;
      background: #ffffff;
      color: #2c3e50;
      height: 100vh;
      position: fixed;
      padding: 25px;
      transition: all 0.3s ease;
      box-shadow: 2px 0 15px rgba(0,0,0,0.08);
      overflow-y: auto;
      border-right: 3px solid #de1f1f; /* åˆåŠ›çº¢è¾¹æ¡† */
      z-index: 100;
    }

    .sidebar h2 {
      margin-top: 0;
      margin-bottom: 30px;
      color: #de1f1f; /* åˆåŠ›çº¢ */
      font-weight: 700;
      border-bottom: 2px solid #e8eaf6;
      padding-bottom: 15px;
      font-size: 18px;
    }

    .sidebar .menu-group {
      margin-bottom: 25px;
    }

    .sidebar .menu-group-title {
      font-size: 14px;
      color: #666666; /* æ ‡é¢˜æ”¹ä¸ºæ·±ç°è‰² */
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .sidebar button {
      width: 100%;
      margin: 8px 0;
      padding: 12px 15px;
      border: none;
      border-radius: 6px;
      background: #f8f9fa;
      color: #2c3e50;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      font-size: 14px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 10px;
      border-left: 3px solid transparent;
    }

    .sidebar button:hover {
      background: #de1f1f; /* åˆåŠ›çº¢hoveræ•ˆæœ */
      color: #ffffff;
      border-left-color: #de1f1f;
      transform: translateX(2px);
    }

    .sidebar button.active {
      background: #de1f1f; /* åˆåŠ›çº¢æ¿€æ´»çŠ¶æ€ */
      color: #ffffff;
      border-left-color: #f39c12; /* é»„è‰²ç‚¹ç¼€ */
      font-weight: 600;
    }

    /* ä¸»å†…å®¹åŒºæ ·å¼ */
    .main {
      flex: 1;
      margin-left: 280px;
      margin-right: 300px;
      padding: 30px;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, #f5f7fa 0%, #e8eaf6 100%);
      position: relative;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    
    .main.full-width {
      margin-right: 0;
    }



    .content-wrapper {
      flex: 1;
      overflow-y: auto;
      padding-right: 10px;
    }

    /* å¡ç‰‡æ ·å¼ - åˆåŠ›ä¼ä¸šé£æ ¼ */
    .card {
      background: #ffffff;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.06);
      margin-bottom: 25px;
      transition: all 0.3s ease;
      position: relative;
      border-left: 4px solid #de1f1f; /* åˆåŠ›çº¢å·¦ä¾§è¾¹æ¡† */
      border-top: 1px solid #e8eaf6;
    }

    .card:hover {
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }

    .card h3 {
      margin-top: 0;
      margin-bottom: 20px;
      color: #2c3e50;
      font-weight: 700;
      border-bottom: 2px solid #e8eaf6;
      padding-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 18px;
    }

    /* è¡¨å•æ§ä»¶æ ·å¼ */
    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #212121;
    }

    input, textarea, select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      transition: border 0.2s ease, box-shadow 0.2s ease;
      background: #fff;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #de1f1f; /* åˆåŠ›çº¢ç„¦ç‚¹è¾¹æ¡† */
      box-shadow: 0 0 0 3px rgba(222, 31, 31, 0.15);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    /* æ–‡ä»¶ä¸Šä¼ æ ·å¼ */
    .file-upload {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 15px;
    }

    .file-upload:hover {
      border-color: #de1f1f;
      background: #fff5f5;
    }

    .file-upload input {
      display: none;
    }

    .file-preview {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }

    .file-item {
      position: relative;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 10px;
      max-width: 150px;
      background: #f9f9f9;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .file-item:hover {
      transform: scale(1.05);
    }

    .file-item img {
      max-width: 100%;
      max-height: 100px;
      object-fit: contain;
      border-radius: 4px;
      margin-bottom: 5px;
    }

    .file-item .file-name {
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .file-item .file-remove {
      position: absolute;
      top: 5px;
      right: 5px;
      background: #e74c3c;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      cursor: pointer;
    }

    /* å›¾ç‰‡æŸ¥çœ‹å™¨ */
    .image-viewer {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .image-viewer.active {
      display: flex;
    }

    .image-viewer img {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
    }

    .image-viewer-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 30px;
      color: white;
      cursor: pointer;
    }

    /* æŒ‰é’®æ ·å¼ - çº¢è‰²ä¸»é¢˜ */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
      margin-right: 10px;
      margin-bottom: 10px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-primary {
      background: #de1f1f; /* åˆåŠ›çº¢æŒ‰é’® */
      color: white;
      border: 1px solid #de1f1f;
    }

    .btn-primary:hover:not(:disabled) {
      background: #c01919;
      border-color: #c01919;
      transform: translateY(-1px);
    }

    .btn-danger {
      background: #e74c3c;
      color: white;
    }

    .btn-danger:hover:not(:disabled) {
      background: #c0392b;
    }

    .btn-secondary {
      background: #95a5a6;
      color: white;
    }

    .btn-secondary:hover:not(:disabled) {
      background: #7f8c8d;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid #de1f1f;
      color: #de1f1f;
      font-weight: 600;
    }

    .btn-outline:hover {
      background: #de1f1f;
      color: white;
      transform: translateY(-1px);
    }

    /* è®°å½•åˆ—è¡¨æ ·å¼ - å³ä¾§å¯æŠ˜å ä¾§è¾¹æ  */
    .records-sidebar {
      position: fixed;
      top: 0;
      right: 0;
      width: 300px;
      height: 100vh;
      background: white;
      box-shadow: -2px 0 15px rgba(0,0,0,0.1);
      z-index: 200;
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease, width 0.3s ease;
      transform: translateX(0);
      border-left: 3px solid #de1f1f; /* åˆåŠ›çº¢è¾¹æ¡† */
    }
    
    .records-sidebar-resizer {
      position: absolute;
      left: 0;
      top: 0;
      width: 5px;
      height: 100%;
      cursor: col-resize;
      background: transparent;
      transition: background 0.2s ease;
    }
    
    .records-sidebar-resizer:hover,
    .records-sidebar-resizer.dragging {
      background: #de1f1f;
    }

    .records-sidebar.collapsed {
      transform: translateX(calc(100% - 50px));
      width: 50px;
      border-left: none; /* æŠ˜å æ—¶éšè—è¾¹æ¡† */
    }
    
    .records-sidebar.collapsed .records-sidebar-header {
      width: 50px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .records-sidebar.collapsed .records-sidebar-header h3 {
      display: none;
    }
    
    .records-sidebar.collapsed .records-sidebar-toggle {
      margin-right: 0 !important;
      font-size: 20px;
    }
    
    .records-sidebar.collapsed .records-sidebar-search,
    .records-sidebar.collapsed .records-sidebar-content,
    .records-sidebar.collapsed .records-sidebar-resizer {
      display: none;
    }

    .records-sidebar-header {
      padding: 15px 20px;
      border-bottom: 1px solid #e8eaf6;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f9fa;
    }

    .records-sidebar-toggle {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: #666;
      padding: 5px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .records-sidebar-toggle:hover {
      background: #de1f1f;
      color: white;
    }

    .records-sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: 0 20px 20px;
    }

    .record {
      border-bottom: 1px solid #eee;
      padding: 20px 0;
      position: relative;
      transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      background: white;
    }

    .record:hover {
      background: #f9f9f9;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .record:last-child {
      border: none;
      margin-bottom: 0;
    }

    .record h4 {
      margin: 0 0 10px 0;
      color: #212121;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .record-meta {
      font-size: 12px;
      color: #7f8c8d;
      margin: 5px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    /* æ ‡ç­¾æ ·å¼ - åˆåŠ›ä¼ä¸šé£æ ¼ */
    .tag {
      display: inline-flex;
      align-items: center;
      background: #3498db; /* è“è‰²æ ‡ç­¾ */
      color: white;
      padding: 6px 12px;
      margin-right: 8px;
      margin-bottom: 8px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      gap: 4px;
      border: 1px solid #2980b9;
    }

    .tag-project {
      background: #de1f1f; /* åˆåŠ›çº¢é¡¹ç›®æ ‡ç­¾ */
      border-color: #c01919;
    }

    /* æ¨¡æ€æ¡†æ ·å¼ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(2px);
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      position: relative;
      animation: modalFadeIn 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
    }

    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #7f8c8d;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s ease;
    }

    .modal-close:hover {
      background: #f1f1f1;
    }

    /* ç©ºçŠ¶æ€æ ·å¼ */
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
    }

    .empty-state i {
      font-size: 48px;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    /* ç»Ÿè®¡ä¿¡æ¯ */
    .stats {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .stat-card {
      flex: 1;
      min-width: 150px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.06);
      border-left: 4px solid #de1f1f; /* åˆåŠ›çº¢å·¦ä¾§è¾¹æ¡† */
      border-top: 1px solid #e8eaf6;
      transition: all 0.3s ease;
    }

    .stat-card .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #de1f1f;
      margin: 8px 0;
    }

    .stat-card .stat-label {
      font-size: 12px;
      color: #7f8c8d;
    }

    /* è‡ªåŠ¨åŒæ­¥è®¾ç½®æ ·å¼ */
    .sync-settings {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: #de1f1f;
    }

    input:checked + .toggle-slider:before {
      transform: translateX(26px);
    }

    /* æ—¥å†æ ·å¼ - åˆåŠ›ä¼ä¸šé£æ ¼ - ä¼˜åŒ–ç‰ˆ */
    .calendar {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.06);
      padding: 25px;
      margin-bottom: 25px;
      border-left: 4px solid #de1f1f;
      border-top: 1px solid #e8eaf6;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .calendar-nav {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .calendar-nav button {
      background: #f5f5f5;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .calendar-nav button:hover {
      background: #de1f1f;
      color: white;
    }

    .calendar-title {
      font-size: 20px;
      font-weight: 600;
      color: #212121;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-weekday {
      text-align: center;
      font-weight: 600;
      color: #7f8c8d;
      padding: 10px;
      font-size: 12px;
      text-transform: uppercase;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      min-height: 60px;
      background: white;
      border: 2px solid transparent;
    }

    .calendar-day:hover {
      background: #f8f9fa;
      border-color: #de1f1f;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .calendar-day.selected {
      background: #ffebee; /* æµ…çº¢è‰²èƒŒæ™¯ */
      border-color: #d32f2f;
      color: #d32f2f;
    }

    .calendar-day.today {
      background: #d32f2f;
      color: white;
      border-color: #c01919;
    }

    .calendar-day.other-month {
      color: #ccc;
      background: #f9f9f9;
    }

    .calendar-day.has-records {
      background: #fff5f5;
      border: 2px solid #de1f1f;
    }

    .calendar-day.has-records:hover {
      background: #fecdd3;
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .calendar-day.today.has-records {
      background: #c01919;
      border: 2px solid #de1f1f;
    }

    .day-number {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 14px;
    }

    .day-record-count {
      font-size: 10px;
      background: #de1f1f;
      color: white;
      border-radius: 10px;
      padding: 2px 6px;
      font-weight: 600;
    }

    .calendar-day.today .day-record-count {
      background: white;
      color: #d32f2f;
    }

    .calendar-day.other-month .day-record-count {
      background: #ccc;
    }

    /* æ—¥å†è§†å›¾åˆ‡æ¢æŒ‰é’® */
    .view-toggle {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .view-toggle button {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .view-toggle button.active {
      background: #de1f1f;
      color: white;
      border-color: #de1f1f;
    }

    .view-toggle button:hover:not(.active) {
      background: #f8f9fa;
    }



    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 1200px) {
      .records-sidebar {
        width: 280px;
      }
      
      .search-filter-container {
        right: 280px;
      }
      
      .search-filter-container.collapsed {
        right: 50px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        position: relative;
        width: 100%;
        height: auto;
        padding: 15px;
        margin-bottom: 15px;
        border-right: none;
        border-bottom: 1px solid #eee;
      }
      
      .main {
        margin-left: 0;
        padding: 15px;
      }
      
      .search-filter-container {
        position: relative;
        left: 0;
        right: 0;
        margin-bottom: 20px;
      }
      
      .content-wrapper {
        margin-top: 0;
      }
      
      .records-sidebar {
        width: 100%;
        height: 50vh;
        top: auto;
        bottom: 0;
        transform: translateY(calc(100% - 50px));
      }
      
      .records-sidebar.collapsed {
        transform: translateY(calc(100% - 50px));
      }
      
      .records-sidebar.expanded {
        transform: translateY(0);
      }
      
      .search-bar {
        flex-direction: column;
      }
      
      .search-bar input, .search-bar select {
        min-width: 100%;
      }
      
      .btn {
        width: 100%;
        margin-right: 0;
      }
      
      .stats {
        flex-direction: column;
      }
      
      .stat-card {
        min-width: 100%;
      }
      
      .calendar-day {
        min-height: 40px;
      }
      
      .day-number {
        font-size: 12px;
      }
      
      .day-record-count {
        font-size: 8px;
      }
    }
  </style>
</head>
<body>
  <!-- ä¾§è¾¹æ  -->
  <div class="sidebar">
    <!-- LogoåŒºåŸŸ - ä¿®æ”¹ä¸ºHELIå›¾ç‰‡æ ·å¼ -->
    <div class="logo-container">
      <img src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/d7055c089b8345a89c60af64300fee9c~tplv-a9rns2rl98-image.image?rcl=20251212124158E3C8DF6D19737AB83456&amp;rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1766119321&amp;x-signature=74fhjYKsIvpjVJ9PNNayjfbdEaE%3D" alt="HELI" class="logo-image">
    </div>
    
    <div class="menu-group">
      <div class="menu-group-title">è§†å›¾åˆ‡æ¢</div>
      <button onclick="showView('list')" class="active">
        <span>ğŸ“‹</span> åˆ—è¡¨è§†å›¾
      </button>
      <button onclick="showView('calendar')">
        <span>ğŸ“…</span> æ—¥å†è§†å›¾
      </button>
    </div>

    <div class="menu-group">
      <div class="menu-group-title">åˆ†ç±»ç®¡ç†</div>
      <button onclick="openProjectManager()">
        <span>ğŸ“</span> é¡¹ç›®åˆ†ç±»ç®¡ç†
      </button>
      <button onclick="openTagManager()">
        <span>ğŸ·ï¸</span> æ ‡ç­¾ç®¡ç†
      </button>
    </div>


    
    <div class="menu-group">
      <div class="menu-group-title">æ•°æ®ç®¡ç†</div>
      <button onclick="openGitHubSettings()">
        <span>ğŸ”§</span> GitHub è®¾ç½®
      </button>
      <button onclick="syncToGitHub()" id="syncBtn">
        <span>â˜ï¸</span> åŒæ­¥åˆ°GitHub
      </button>
      <button onclick="syncFromGitHub()" id="pullBtn">
        <span>â¬‡ï¸</span> ä»GitHubæ›´æ–°
      </button>
      <button onclick="exportLocal()">
        <span>ğŸ“¤</span> æœ¬åœ°å¯¼å‡º
      </button>
      <button onclick="importLocal()">
        <span>ğŸ“¥</span> æœ¬åœ°å¯¼å…¥
      </button>
    </div>
  </div>

  <!-- ä¸»å†…å®¹åŒº -->
  <div class="main">
    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content-wrapper">
      <!-- ç»Ÿè®¡å¡ç‰‡ -->
      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">æ€»è®°å½•æ•°</div>
          <div class="stat-value" id="totalRecords">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ä»Šæ—¥è®°å½•</div>
          <div class="stat-value" id="todayRecords">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">é¡¹ç›®æ€»æ•°</div>
          <div class="stat-value" id="totalProjects">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ ‡ç­¾æ€»æ•°</div>
          <div class="stat-value" id="totalTags">0</div>
        </div>
      </div>

      <!-- è§†å›¾åˆ‡æ¢æŒ‰é’® -->
      <div class="view-toggle">
        <button onclick="showView('list')" class="active" id="listViewBtn">åˆ—è¡¨è§†å›¾</button>
        <button onclick="showView('calendar')" id="calendarViewBtn">æ—¥å†è§†å›¾</button>
      </div>

      <!-- åˆ—è¡¨è§†å›¾å†…å®¹ -->
      <div id="listView">
        <!-- æ·»åŠ è®°å½•å¡ç‰‡ -->
        <div class="card">
          <h3>
            <span>æ·»åŠ å·¥ä½œè®°å½•</span>
            <button class="btn btn-outline" onclick="clearForm()">æ¸…ç©º</button>
          </h3>
          <div class="form-group">
            <label for="title">è®°å½•æ ‡é¢˜ <span style="color:#d32f2f">*</span></label>
            <input id="title" placeholder="è¯·è¾“å…¥è®°å½•æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰">
          </div>
          <div class="form-group">
            <label for="projectSelect">é¡¹ç›®åˆ†ç±»</label>
            <select id="projectSelect">
              <option value="">é€‰æ‹©é¡¹ç›®åˆ†ç±»</option>
            </select>
          </div>
          <div class="form-group">
            <label for="tagSelect">æ ‡ç­¾</label>
            <select id="tagSelect" multiple="">
            </select>
            <small style="color: #7f8c8d;">æŒ‰ä½Ctrlé”®å¯å¤šé€‰æ ‡ç­¾</small>
          </div>
          <div class="form-group">
            <label for="content">è®°å½•å†…å®¹</label>
            <textarea id="content" placeholder="è¯·è¾“å…¥è¯¦ç»†çš„å·¥ä½œå†…å®¹"></textarea>
          </div>
          <div class="form-group">
            <label>é™„ä»¶ä¸Šä¼ </label>
            <div class="file-upload" onclick="document.getElementById('fileInput').click()">
              <p>ğŸ“ ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶/å›¾ç‰‡</p>
              <p style="font-size: 12px; color: #7f8c8d;">æ”¯æŒå›¾ç‰‡ã€æ–‡æ¡£ç­‰æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡5MB</p>
              <input type="file" id="fileInput" multiple="" accept="image/*,.pdf,.doc,.docx,.txt,.zip" onchange="handleFileUpload(this.files)">
            </div>
            <div class="file-preview" id="filePreview"></div>
          </div>
          <button class="btn btn-primary" onclick="addRecord()" id="addRecordBtn">
            <span>âœš</span> æ·»åŠ è®°å½•
          </button>
        </div>
      </div>

      <!-- æ—¥å†è§†å›¾å†…å®¹ -->
      <div id="calendarView" style="display: none;">
        <!-- æ—¥å†å¡ç‰‡ -->
        <div class="calendar">
          <div class="calendar-header">
            <div class="calendar-nav">
              <button onclick="changeMonth(-1)">â€¹</button>
              <div class="calendar-title" id="calendarTitle">2024å¹´1æœˆ</div>
              <button onclick="changeMonth(1)">â€º</button>
            </div>
            <button class="btn btn-primary" onclick="goToToday()">ä»Šå¤©</button>
          </div>
          <div class="calendar-grid" id="calendarGrid">
            <!-- æ—¥å†ç½‘æ ¼å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
          </div>
        </div>

        <!-- é€‰ä¸­æ—¥æœŸçš„è®°å½•åˆ—è¡¨ -->
        <div class="calendar-actions" style="margin-top: 20px; text-align: center;">
          <button class="btn btn-primary" onclick="addRecordForDate()" id="addRecordForDateBtn">
            <span>âœš</span> ä¸ºé€‰ä¸­æ—¥æœŸæ·»åŠ è®°å½•
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- å³ä¾§è®°å½•åˆ—è¡¨ä¾§è¾¹æ  -->
  <div class="records-sidebar" id="recordsSidebar">
    <div class="records-sidebar-resizer" id="sidebarResizer"></div>
    <div class="records-sidebar-header">
      <button class="records-sidebar-toggle" onclick="toggleRecordsSidebar()" style="margin-right: 10px;">
        <span id="sidebarToggleIcon">â€¹</span>
      </button>
      <h3>å·¥ä½œè®°å½•åˆ—è¡¨ <span id="sidebarRecordCount" style="font-size: 14px; font-weight: normal; color: #7f8c8d;">å…± 0 æ¡</span></h3>
    </div>
    <!-- æœç´¢ç­›é€‰åŒºåŸŸ -->
    <div class="records-sidebar-search">
      <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin: 0 15px 15px; border: 2px solid #e8eaf6;">
        <div style="display: flex; gap: 5px; margin-bottom: 10px;">
          <input id="searchInput" placeholder="æœç´¢æ ‡é¢˜/å†…å®¹/æ ‡ç­¾" style="flex: 1; margin-bottom: 0;" onkeypress="if(event.key === 'Enter') performSearch()">
          <button class="btn btn-primary" onclick="performSearch()" style="min-width: 40px; padding: 12px;">
            <span>ğŸ”</span>
          </button>
        </div>
        <select id="projectFilter" onchange="filterRecords()" style="margin-bottom: 10px;">
          <option value="">æ‰€æœ‰é¡¹ç›®</option>
        </select>
        <select id="tagFilter" onchange="filterRecords()" style="margin-bottom: 10px;">
          <option value="">æ‰€æœ‰æ ‡ç­¾</option>
        </select>
        <button class="btn btn-secondary" onclick="resetFilters()" style="width: 100%; min-width: auto;">
          <span>ğŸ”„</span> é‡ç½®ç­›é€‰
        </button>
      </div>
    </div>
    <div class="records-sidebar-content">
      <div id="sidebarRecordList"></div>
    </div>
  </div>

  <!-- å›¾ç‰‡æŸ¥çœ‹å™¨ -->
  <div class="image-viewer" id="imageViewer">
    <span class="image-viewer-close" onclick="closeImageViewer()">Ã—</span>
    <img id="viewerImage" src="" alt="é¢„è§ˆå›¾ç‰‡">
  </div>

  <!-- ç¼–è¾‘è®°å½•æ¨¡æ€æ¡† -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">Ã—</span>
      <h3>ç¼–è¾‘è®°å½•</h3>
      <div class="form-group">
        <label for="editTitle">è®°å½•æ ‡é¢˜ <span style="color:#d32f2f">*</span></label>
        <input id="editTitle" placeholder="è¯·è¾“å…¥è®°å½•æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰">
      </div>
      <div class="form-group">
        <label for="editProjectSelect">é¡¹ç›®åˆ†ç±»</label>
        <select id="editProjectSelect">
          <option value="">é€‰æ‹©é¡¹ç›®åˆ†ç±»</option>
        </select>
      </div>
      <div class="form-group">
        <label for="editTagSelect">æ ‡ç­¾</label>
        <select id="editTagSelect" multiple="">
        </select>
        <small style="color: #7f8c8d;">æŒ‰ä½Ctrlé”®å¯å¤šé€‰æ ‡ç­¾</small>
      </div>
      <div class="form-group">
        <label for="editContent">è®°å½•å†…å®¹</label>
        <textarea id="editContent" placeholder="è¯·è¾“å…¥è¯¦ç»†çš„å·¥ä½œå†…å®¹"></textarea>
      </div>
      <div class="form-group">
        <label>é™„ä»¶ç®¡ç†</label>
        <div class="file-upload" onclick="document.getElementById('editFileInput').click()">
          <p>ğŸ“ ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶/å›¾ç‰‡</p>
          <input type="file" id="editFileInput" multiple="" accept="image/*,.pdf,.doc,.docx,.txt,.zip" onchange="handleFileUpload(this.files, 'edit')">
        </div>
        <div class="file-preview" id="editFilePreview"></div>
      </div>
      <button class="btn btn-primary" onclick="saveEdit()">
        <span>ğŸ’¾</span> ä¿å­˜ä¿®æ”¹
      </button>
      <button class="btn btn-secondary" onclick="closeModal()">
        <span>âŒ</span> å–æ¶ˆ
      </button>
      <input type="hidden" id="editRecordId">
    </div>
  </div>

  <!-- æ·»åŠ è®°å½•æ¨¡æ€æ¡†ï¼ˆæ—¥å†è§†å›¾ç”¨ï¼‰ -->
  <div id="addRecordModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">Ã—</span>
      <h3>æ·»åŠ è®°å½•</h3>
      <div class="form-group">
        <label for="addDateTitle">è®°å½•æ ‡é¢˜ <span style="color:#d32f2f">*</span></label>
        <input id="addDateTitle" placeholder="è¯·è¾“å…¥è®°å½•æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰">
      </div>
      <div class="form-group">
        <label for="addDateProjectSelect">é¡¹ç›®åˆ†ç±»</label>
        <select id="addDateProjectSelect">
          <option value="">é€‰æ‹©é¡¹ç›®åˆ†ç±»</option>
        </select>
      </div>
      <div class="form-group">
        <label for="addDateTagSelect">æ ‡ç­¾</label>
        <select id="addDateTagSelect" multiple="">
        </select>
        <small style="color: #7f8c8d;">æŒ‰ä½Ctrlé”®å¯å¤šé€‰æ ‡ç­¾</small>
      </div>
      <div class="form-group">
        <label for="addDateContent">è®°å½•å†…å®¹</label>
        <textarea id="addDateContent" placeholder="è¯·è¾“å…¥è¯¦ç»†çš„å·¥ä½œå†…å®¹"></textarea>
      </div>
      <div class="form-group">
        <label>é™„ä»¶ä¸Šä¼ </label>
        <div class="file-upload" onclick="document.getElementById('addDateFileInput').click()">
          <p>ğŸ“ ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶/å›¾ç‰‡</p>
          <input type="file" id="addDateFileInput" multiple="" accept="image/*,.pdf,.doc,.docx,.txt,.zip" onchange="handleFileUpload(this.files, 'addDate')">
        </div>
        <div class="file-preview" id="addDateFilePreview"></div>
      </div>
      <button class="btn btn-primary" onclick="saveRecordForDate()">
        <span>ğŸ’¾</span> ä¿å­˜è®°å½•
      </button>
      <button class="btn btn-secondary" onclick="closeModal()">
        <span>âŒ</span> å–æ¶ˆ
      </button>
      <input type="hidden" id="addDateSelectedDate">
    </div>
  </div>

  <!-- é¡¹ç›®ç®¡ç†æ¨¡æ€æ¡† -->
  <div id="projectModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">Ã—</span>
      <h3>é¡¹ç›®åˆ†ç±»ç®¡ç†</h3>
      <div class="form-group">
        <label for="newProjectName">æ–°é¡¹ç›®åç§° <span style="color:#d32f2f">*</span></label>
        <input id="newProjectName" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°">
      </div>
      <button class="btn btn-primary" onclick="addProject()">
        <span>âœš</span> æ·»åŠ é¡¹ç›®
      </button>
      <div id="projectList" style="margin-top: 20px;"></div>
    </div>
  </div>

  <!-- æ ‡ç­¾ç®¡ç†æ¨¡æ€æ¡† -->
  <div id="tagModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">Ã—</span>
      <h3>æ ‡ç­¾ç®¡ç†</h3>
      <div class="form-group">
        <label for="newTagName">æ–°æ ‡ç­¾åç§° <span style="color:#d32f2f">*</span></label>
        <input id="newTagName" placeholder="è¯·è¾“å…¥æ ‡ç­¾åç§°">
      </div>
      <button class="btn btn-primary" onclick="addTag()">
        <span>âœš</span> æ·»åŠ æ ‡ç­¾
      </button>
      <div id="tagList" style="margin-top: 20px;"></div>
    </div>
  </div>

  <!-- GitHubè®¾ç½®æ¨¡æ€æ¡† -->
  <div id="githubModal" class="modal">
    <div class="modal-content">
      <span class="modal-close" onclick="closeModal()">Ã—</span>
      <h3>GitHub åŒæ­¥è®¾ç½®</h3>
      <div class="form-group">
        <label for="githubOwner">GitHub è´¦æˆ·å <span style="color:#d32f2f">*</span></label>
        <input id="githubOwner" placeholder="ä¾‹å¦‚ï¼šusername" value="">
      </div>
      <div class="form-group">
        <label for="githubRepo">ä»“åº“å <span style="color:#d32f2f">*</span></label>
        <input id="githubRepo" placeholder="ä¾‹å¦‚ï¼šworklog-backup" value="">
      </div>
      <div class="form-group">
        <label for="githubToken">Personal Access Token <span style="color:#d32f2f">*</span></label>
        <input id="githubToken" type="password" placeholder="éœ€è¦repoæƒé™çš„Token" value="">
      </div>
      <div class="sync-settings">
        <label class="toggle-switch">
          <input type="checkbox" id="autoSyncToggle">
          <span class="toggle-slider"></span>
        </label>
        <span>å¯ç”¨è‡ªåŠ¨åŒæ­¥ï¼ˆæ¯30åˆ†é’Ÿï¼‰</span>
      </div>
      <div class="sync-settings">
        <label class="toggle-switch">
          <input type="checkbox" id="autoPullToggle">
          <span class="toggle-slider"></span>
        </label>
        <span>å¯åŠ¨æ—¶è‡ªåŠ¨ä»GitHubæ›´æ–°</span>
      </div>
      <button class="btn btn-primary" onclick="saveGitHubConfig()">
        <span>ğŸ’¾</span> ä¿å­˜è®¾ç½®
      </button>
      <button class="btn btn-secondary" onclick="closeModal()">
        <span>âŒ</span> å–æ¶ˆ
      </button>
    </div>
  </div>

  <!-- é€šçŸ¥æç¤º -->
  <div class="toast" id="toast"></div>

  <script>
    // å…¨å±€æ•°æ®å­˜å‚¨
    let records = JSON.parse(localStorage.getItem('records') || '[]');
    let projects = JSON.parse(localStorage.getItem('projects') || '[]');
    let tags = JSON.parse(localStorage.getItem('tags') || '[]');
    let githubConfig = JSON.parse(localStorage.getItem('githubConfig') || '{}');
    let currentView = 'list';
    let uploadedFiles = [];
    let editUploadedFiles = [];
    let addDateUploadedFiles = [];
    let recordsSidebarCollapsed = false;
    
    // æ—¥å†ç›¸å…³å˜é‡
    let currentDate = new Date();
    let selectedDate = new Date();
    
    // è‡ªåŠ¨åŒæ­¥ç›¸å…³é…ç½®
    let autoSyncInterval = null;
    const AUTO_SYNC_INTERVAL = 30 * 60 * 1000; // 30åˆ†é’Ÿ
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      renderProjects();
      renderTags();
      updateStats();
      render();
      showView('list');
      
      // åŠ è½½GitHubé…ç½®
      loadGitHubConfig();
      
      // æ£€æŸ¥è‡ªåŠ¨åŒæ­¥è®¾ç½®
      checkAutoSyncSettings();
      
      // å¯åŠ¨æ—¶è‡ªåŠ¨ä»GitHubæ›´æ–°ï¼ˆå¦‚æœå¯ç”¨ï¼‰
      if (githubConfig.autoPull === true) {
        setTimeout(() => {
          syncFromGitHub(true);
        }, 3000);
      }
      
      // ç›‘å¬ESCé”®å…³é—­æ¨¡æ€æ¡†
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeModal();
          closeImageViewer();
        }
      });
      
      // åˆå§‹åŒ–ä¾§è¾¹æ æ‹–æ‹½è°ƒæ•´åŠŸèƒ½
      initSidebarResizer();
    });
    
    // ä¾§è¾¹æ æ‹–æ‹½è°ƒæ•´åŠŸèƒ½
    function initSidebarResizer() {
      const sidebar = document.getElementById('recordsSidebar');
      const resizer = document.getElementById('sidebarResizer');
      let isResizing = false;
      let startX, startWidth;
      
      resizer.addEventListener('mousedown', function(e) {
        isResizing = true;
        startX = e.clientX;
        startWidth = sidebar.offsetWidth;
        resizer.classList.add('dragging');
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
      });
      
      document.addEventListener('mousemove', function(e) {
        if (!isResizing) return;
        
        const deltaX = startX - e.clientX;
        let newWidth = startWidth + deltaX;
        
        // é™åˆ¶æœ€å°å’Œæœ€å¤§å®½åº¦
        newWidth = Math.max(200, Math.min(600, newWidth));
        
        sidebar.style.width = newWidth + 'px';
      });
      
      document.addEventListener('mouseup', function() {
        if (isResizing) {
          isResizing = false;
          resizer.classList.remove('dragging');
          document.body.style.cursor = '';
          document.body.style.userSelect = '';
        }
      });
    }

    // ========== å·¥å…·å‡½æ•° ==========
    function showToast(message, type = 'info', duration = 3000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }

    function debounce(func, wait = 300) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    async function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
      });
    }

    // ========== å›¾ç‰‡æŸ¥çœ‹å™¨åŠŸèƒ½ ==========
    function openImageViewer(imageUrl) {
      const viewer = document.getElementById('imageViewer');
      const viewerImage = document.getElementById('viewerImage');
      viewerImage.src = imageUrl;
      viewer.classList.add('active');
    }

    function closeImageViewer() {
      const viewer = document.getElementById('imageViewer');
      viewer.classList.remove('active');
    }

    // ========== æ ¸å¿ƒå­˜å‚¨å‡½æ•° ==========
    function saveRecords() {
      try {
        localStorage.setItem('records', JSON.stringify(records));
        updateStats();
        showToast('æ•°æ®å·²ä¿å­˜', 'success');
      } catch (error) {
        showToast('ä¿å­˜å¤±è´¥ï¼š' + error.message, 'error');
      }
    }

    function saveProjects() {
      try {
        localStorage.setItem('projects', JSON.stringify(projects));
        renderProjects();
        updateStats();
        showToast('é¡¹ç›®å·²ä¿å­˜', 'success');
      } catch (error) {
        showToast('ä¿å­˜å¤±è´¥ï¼š' + error.message, 'error');
      }
    }

    function saveTags() {
      try {
        localStorage.setItem('tags', JSON.stringify(tags));
        renderTags();
        updateStats();
        showToast('æ ‡ç­¾å·²ä¿å­˜', 'success');
      } catch (error) {
        showToast('ä¿å­˜å¤±è´¥ï¼š' + error.message, 'error');
      }
    }

    // ========== ç»Ÿè®¡æ›´æ–° ==========
    function updateStats() {
      document.getElementById('totalRecords').textContent = records.length;
      
      // ä»Šæ—¥è®°å½•æ•°
      const today = new Date().toDateString();
      const todayCount = records.filter(r => new Date(r.date).toDateString() === today).length;
      document.getElementById('todayRecords').textContent = todayCount;
      
      document.getElementById('totalProjects').textContent = projects.length;
      document.getElementById('totalTags').textContent = tags.length;
      
      // æ›´æ–°ä¾§è¾¹æ è®°å½•æ•°
      document.getElementById('sidebarRecordCount').textContent = `å…± ${records.length} æ¡`;
    }

    // ========== æ–‡ä»¶ä¸Šä¼ ä¸é¢„è§ˆ ==========
    async function handleFileUpload(files, type = 'add') {
      const previewContainer = document.getElementById(type === 'add' ? 'filePreview' : (type === 'edit' ? 'editFilePreview' : 'addDateFilePreview'));
      const fileArray = type === 'add' ? uploadedFiles : (type === 'edit' ? editUploadedFiles : addDateUploadedFiles);
      
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        
        if (file.size > 5 * 1024 * 1024) {
          showToast(`æ–‡ä»¶ ${file.name} è¶…è¿‡5MBé™åˆ¶`, 'error');
          continue;
        }
        
        try {
          const base64Data = await fileToBase64(file);
          const fileObj = {
            id: Date.now() + i,
            name: file.name,
            type: file.type,
            size: file.size,
            data: base64Data
          };
          
          fileArray.push(fileObj);
          
          const fileItem = document.createElement('div');
          fileItem.className = 'file-item';
          fileItem.dataset.fileId = fileObj.id;
          
          let filePreview = '';
          if (file.type.startsWith('image/')) {
            filePreview = `<img src="${base64Data}" alt="${file.name}" onclick="openImageViewer('${base64Data}')" />`;
          } else {
            filePreview = `<div style="text-align:center; padding:20px; font-size:24px;">ğŸ“„</div>`;
          }
          
          fileItem.innerHTML = `
            ${filePreview}
            <div class="file-name">${file.name}</div>
            <div style="font-size:10px; color:#7f8c8d;">${(file.size / 1024).toFixed(1)}KB</div>
            <div class="file-remove" onclick="removeFile(${fileObj.id}, '${type}')">Ã—</div>
          `;
          
          previewContainer.appendChild(fileItem);
        } catch (error) {
          showToast(`æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š${error.message}`, 'error');
        }
      }
    }

    function removeFile(fileId, type = 'add') {
      const previewContainer = document.getElementById(type === 'add' ? 'filePreview' : (type === 'edit' ? 'editFilePreview' : 'addDateFilePreview'));
      const fileArray = type === 'add' ? uploadedFiles : (type === 'edit' ? editUploadedFiles : addDateUploadedFiles);
      
      const index = fileArray.findIndex(f => f.id === fileId);
      if (index !== -1) {
        fileArray.splice(index, 1);
      }
      
      const fileItem = previewContainer.querySelector(`[data-file-id="${fileId}"]`);
      if (fileItem) {
        fileItem.remove();
      }
    }

    // ========== è®°å½•ç®¡ç†åŠŸèƒ½ ==========
    function addRecord() {
      const titleInput = document.getElementById('title');
      const title = titleInput.value.trim();
      const content = document.getElementById('content').value.trim();
      const projectId = document.getElementById('projectSelect').value;
      
      const tagSelect = document.getElementById('tagSelect');
      const selectedTags = Array.from(tagSelect.selectedOptions).map(option => option.value);

      if (!title) {
        showToast('è¯·è¾“å…¥è®°å½•æ ‡é¢˜ï¼', 'error');
        titleInput.focus();
        return;
      }

      const newRecord = {
        id: Date.now(),
        title,
        content,
        projectId,
        tags: selectedTags,
        files: [...uploadedFiles],
        date: new Date().toISOString(),
        updateTime: new Date().toISOString()
      };

      records.push(newRecord);
      saveRecords();
      render();
      
      clearForm();
      uploadedFiles = [];
      document.getElementById('filePreview').innerHTML = '';
      showToast('è®°å½•æ·»åŠ æˆåŠŸï¼', 'success');
    }

    function addRecordForDate() {
      const modal = document.getElementById('addRecordModal');
      modal.style.display = 'flex';
      
      // è®¾ç½®é€‰ä¸­æ—¥æœŸ
      document.getElementById('addDateSelectedDate').value = selectedDate.toISOString();
      
      // æ¸…ç©ºè¡¨å•
      document.getElementById('addDateTitle').value = '';
      document.getElementById('addDateContent').value = '';
      document.getElementById('addDateProjectSelect').value = '';
      document.getElementById('addDateTagSelect').selectedIndex = -1;
      document.getElementById('addDateFilePreview').innerHTML = '';
      addDateUploadedFiles = [];
      
      setTimeout(() => {
        document.getElementById('addDateTitle').focus();
      }, 100);
    }

    function saveRecordForDate() {
      const titleInput = document.getElementById('addDateTitle');
      const title = titleInput.value.trim();
      const content = document.getElementById('addDateContent').value.trim();
      const projectId = document.getElementById('addDateProjectSelect').value;
      const selectedDateStr = document.getElementById('addDateSelectedDate').value;
      
      const tagSelect = document.getElementById('addDateTagSelect');
      const selectedTags = Array.from(tagSelect.selectedOptions).map(option => option.value);

      if (!title) {
        showToast('è¯·è¾“å…¥è®°å½•æ ‡é¢˜ï¼', 'error');
        titleInput.focus();
        return;
      }

      const newRecord = {
        id: Date.now(),
        title,
        content,
        projectId,
        tags: selectedTags,
        files: [...addDateUploadedFiles],
        date: selectedDateStr,
        updateTime: new Date().toISOString()
      };

      records.push(newRecord);
      saveRecords();
      
      // æ›´æ–°æ—¥å†è§†å›¾
      renderCalendar();
      renderSelectedDateRecords();
      
      closeModal();
      showToast('è®°å½•æ·»åŠ æˆåŠŸï¼', 'success');
    }

    function clearForm() {
      document.getElementById('title').value = '';
      document.getElementById('content').value = '';
      document.getElementById('projectSelect').value = '';
      document.getElementById('tagSelect').selectedIndex = -1;
      document.getElementById('title').focus();
    }

    function deleteRecord(id) {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        const recordIndex = records.findIndex(r => r.id === id);
        if (recordIndex !== -1) {
          records.splice(recordIndex, 1);
          saveRecords();
          render();
          
          // å¦‚æœåœ¨æ—¥å†è§†å›¾ä¸­ï¼Œæ›´æ–°æ—¥å†å’Œé€‰ä¸­æ—¥æœŸçš„è®°å½•
          if (currentView === 'calendar') {
            renderCalendar();
            renderSelectedDateRecords();
          }
          
          showToast('è®°å½•å·²åˆ é™¤', 'success');
        }
      }
    }

    function editRecord(id) {
      const record = records.find(r => r.id === id);
      if (!record) {
        showToast('æ‰¾ä¸åˆ°è¯¥è®°å½•', 'error');
        return;
      }

      document.getElementById('editRecordId').value = id;
      document.getElementById('editTitle').value = record.title;
      document.getElementById('editContent').value = record.content;
      document.getElementById('editProjectSelect').value = record.projectId || '';
      
      const tagSelect = document.getElementById('editTagSelect');
      Array.from(tagSelect.options).forEach(option => {
        option.selected = record.tags && record.tags.includes(option.value);
      });
      
      editUploadedFiles = record.files || [];
      const previewContainer = document.getElementById('editFilePreview');
      previewContainer.innerHTML = '';
      
      (record.files || []).forEach(file => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.dataset.fileId = file.id;
        
        let filePreview = '';
        if (file.type.startsWith('image/')) {
          filePreview = `<img src="${file.data}" alt="${file.name}" onclick="openImageViewer('${file.data}')" />`;
        } else {
          filePreview = `<div style="text-align:center; padding:20px; font-size:24px;">ğŸ“„</div>`;
        }
        
        fileItem.innerHTML = `
          ${filePreview}
          <div class="file-name">${file.name}</div>
          <div style="font-size:10px; color:#7f8c8d;">${(file.size / 1024).toFixed(1)}KB</div>
          <div class="file-remove" onclick="removeFile(${file.id}, 'edit')">Ã—</div>
        `;
        
        previewContainer.appendChild(fileItem);
      });
      
      document.getElementById('editModal').style.display = 'flex';
      setTimeout(() => {
        document.getElementById('editTitle').focus();
      }, 100);
    }

    function saveEdit() {
      const id = parseInt(document.getElementById('editRecordId').value);
      const titleInput = document.getElementById('editTitle');
      const title = titleInput.value.trim();
      const content = document.getElementById('editContent').value.trim();
      const projectId = document.getElementById('editProjectSelect').value;
      
      const tagSelect = document.getElementById('editTagSelect');
      const selectedTags = Array.from(tagSelect.selectedOptions).map(option => option.value);

      if (!title) {
        showToast('è¯·è¾“å…¥è®°å½•æ ‡é¢˜ï¼', 'error');
        titleInput.focus();
        return;
      }

      const index = records.findIndex(r => r.id === id);
      if (index !== -1) {
        records[index] = {
          ...records[index],
          title,
          content,
          projectId,
          tags: selectedTags,
          files: [...editUploadedFiles],
          updateTime: new Date().toISOString()
        };
        saveRecords();
        render();
        
        // å¦‚æœåœ¨æ—¥å†è§†å›¾ä¸­ï¼Œæ›´æ–°æ—¥å†å’Œé€‰ä¸­æ—¥æœŸçš„è®°å½•
        if (currentView === 'calendar') {
          renderCalendar();
          renderSelectedDateRecords();
        }
        
        closeModal();
        showToast('è®°å½•å·²æ›´æ–°', 'success');
      } else {
        showToast('è®°å½•ä¸å­˜åœ¨', 'error');
      }
    }

    // ========== é¡¹ç›®åˆ†ç±»ç®¡ç† ==========
    function renderProjects() {
      const projectSelect = document.getElementById('projectSelect');
      const editProjectSelect = document.getElementById('editProjectSelect');
      const projectFilter = document.getElementById('projectFilter');
      const addDateProjectSelect = document.getElementById('addDateProjectSelect');
      
      [projectSelect, editProjectSelect, projectFilter, addDateProjectSelect].forEach(select => {
        if (select) {
          select.innerHTML = '<option value="">é€‰æ‹©é¡¹ç›®åˆ†ç±»</option>';
          projects.forEach(project => {
            const option = document.createElement('option');
            option.value = project.id;
            option.textContent = project.name;
            select.appendChild(option);
          });
        }
      });

      const projectList = document.getElementById('projectList');
      projectList.innerHTML = '';
      
      if (projects.length === 0) {
        projectList.innerHTML = '<div class="empty-state">æš‚æ— é¡¹ç›®åˆ†ç±»</div>';
        return;
      }

      projects.forEach(project => {
        const recordCount = records.filter(r => r.projectId == project.id).length;
        
        const div = document.createElement('div');
        div.style.display = 'flex';
        div.style.justifyContent = 'space-between';
        div.style.alignItems = 'center';
        div.style.padding = '10px';
        div.style.borderBottom = '1px solid #eee';
        
        div.innerHTML = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <span>ğŸ“ ${project.name}</span>
            <span style="font-size: 12px; color: #7f8c8d;">(${recordCount}æ¡è®°å½•)</span>
          </div>
          <button class="btn btn-danger" style="padding: 5px 10px;" 
            onclick="deleteProject(${project.id})"
            ${recordCount > 0 ? 'disabled title="è¯¥é¡¹ç›®ä¸‹æœ‰è®°å½•ï¼Œæ— æ³•åˆ é™¤"' : ''}>
            åˆ é™¤
          </button>
        `;
        projectList.appendChild(div);
      });
    }

    function openProjectManager() {
      document.getElementById('projectModal').style.display = 'flex';
      setTimeout(() => {
        document.getElementById('newProjectName').focus();
      }, 100);
    }

    function addProject() {
      const nameInput = document.getElementById('newProjectName');
      const name = nameInput.value.trim();
      
      if (!name) {
        showToast('è¯·è¾“å…¥é¡¹ç›®åç§°ï¼', 'error');
        nameInput.focus();
        return;
      }
      
      if (projects.some(p => p.name.toLowerCase() === name.toLowerCase())) {
        showToast('è¯¥é¡¹ç›®åç§°å·²å­˜åœ¨ï¼', 'error');
        nameInput.focus();
        return;
      }

      projects.push({
        id: Date.now(),
        name
      });
      
      saveProjects();
      nameInput.value = '';
      nameInput.focus();
    }

    function deleteProject(id) {
      const hasRecords = records.some(r => r.projectId == id);
      if (hasRecords) {
        showToast('è¯¥é¡¹ç›®ä¸‹æœ‰è®°å½•ï¼Œæ— æ³•åˆ é™¤ï¼', 'error');
        return;
      }
      
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¡¹ç›®å—ï¼Ÿ')) {
        projects = projects.filter(p => p.id !== id);
        saveProjects();
      }
    }

    // ========== æ ‡ç­¾ç®¡ç† ==========
    function renderTags() {
      const tagSelect = document.getElementById('tagSelect');
      const editTagSelect = document.getElementById('editTagSelect');
      const tagFilter = document.getElementById('tagFilter');
      const addDateTagSelect = document.getElementById('addDateTagSelect');
      
      [tagSelect, editTagSelect, tagFilter, addDateTagSelect].forEach(select => {
        if (select) {
          select.innerHTML = '';
          if (select.id === 'tagFilter') {
            select.innerHTML = '<option value="">æ‰€æœ‰æ ‡ç­¾</option>';
          }
          tags.forEach(tag => {
            const option = document.createElement('option');
            option.value = tag.id;
            option.textContent = tag.name;
            select.appendChild(option);
          });
        }
      });

      const tagList = document.getElementById('tagList');
      tagList.innerHTML = '';
      
      if (tags.length === 0) {
        tagList.innerHTML = '<div class="empty-state">æš‚æ— æ ‡ç­¾</div>';
        return;
      }

      tags.forEach(tag => {
        const recordCount = records.filter(r => r.tags && r.tags.includes(tag.id.toString())).length;
        
        const div = document.createElement('div');
        div.style.display = 'flex';
        div.style.justifyContent = 'space-between';
        div.style.alignItems = 'center';
        div.style.padding = '10px';
        div.style.borderBottom = '1px solid #eee';
        
        div.innerHTML = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <span>ğŸ·ï¸ ${tag.name}</span>
            <span style="font-size: 12px; color: #7f8c8d;">(${recordCount}æ¡è®°å½•)</span>
          </div>
          <button class="btn btn-danger" style="padding: 5px 10px;" 
            onclick="deleteTag(${tag.id})"
            ${recordCount > 0 ? 'disabled title="è¯¥æ ‡ç­¾ä¸‹æœ‰è®°å½•ï¼Œæ— æ³•åˆ é™¤"' : ''}>
            åˆ é™¤
          </button>
        `;
        tagList.appendChild(div);
      });
    }

    function openTagManager() {
      document.getElementById('tagModal').style.display = 'flex';
      setTimeout(() => {
        document.getElementById('newTagName').focus();
      }, 100);
    }

    function addTag() {
      const nameInput = document.getElementById('newTagName');
      const name = nameInput.value.trim();
      
      if (!name) {
        showToast('è¯·è¾“å…¥æ ‡ç­¾åç§°ï¼', 'error');
        nameInput.focus();
        return;
      }
      
      if (tags.some(t => t.name.toLowerCase() === name.toLowerCase())) {
        showToast('è¯¥æ ‡ç­¾åç§°å·²å­˜åœ¨ï¼', 'error');
        nameInput.focus();
        return;
      }

      tags.push({
        id: Date.now(),
        name
      });
      
      saveTags();
      nameInput.value = '';
      nameInput.focus();
    }

    function deleteTag(id) {
      const hasRecords = records.some(r => r.tags && r.tags.includes(id.toString()));
      if (hasRecords) {
        showToast('è¯¥æ ‡ç­¾ä¸‹æœ‰è®°å½•ï¼Œæ— æ³•åˆ é™¤ï¼', 'error');
        return;
      }
      
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ ‡ç­¾å—ï¼Ÿ')) {
        tags = tags.filter(t => t.id !== id);
        saveTags();
      }
    }

    // ========== è§†å›¾åˆ‡æ¢åŠŸèƒ½ ==========
    function showView(type) {
      currentView = type;
      
      // æ›´æ–°ä¾§è¾¹æ æŒ‰é’®æ¿€æ´»çŠ¶æ€
      document.querySelectorAll('.sidebar button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent.includes({
          'list': 'åˆ—è¡¨è§†å›¾',
          'calendar': 'æ—¥å†è§†å›¾'
        }[type])) {
          btn.classList.add('active');
        }
      });
      
      // æ›´æ–°è§†å›¾åˆ‡æ¢æŒ‰é’®çŠ¶æ€
      document.getElementById('listViewBtn').classList.toggle('active', type === 'list');
      document.getElementById('calendarViewBtn').classList.toggle('active', type === 'calendar');
      
      // æ˜¾ç¤ºå¯¹åº”çš„è§†å›¾
      document.getElementById('listView').style.display = type === 'list' ? 'block' : 'none';
      document.getElementById('calendarView').style.display = type === 'calendar' ? 'block' : 'none';
      
      // è‡ªåŠ¨æ‰“å¼€ä¾§è¾¹æ å¹¶åŒæ­¥æ›´æ–°å¸ƒå±€
      openRecordsSidebar();
      
      if (type === 'calendar') {
        renderCalendar();
      } else {
        filterRecords();
      }
    }

    // ========== è®°å½•ä¾§è¾¹æ åŠŸèƒ½ ==========
    function toggleRecordsSidebar() {
      const sidebar = document.getElementById('recordsSidebar');
      const mainContent = document.querySelector('.main');
      const toggleIcon = document.getElementById('sidebarToggleIcon');
      
      recordsSidebarCollapsed = !recordsSidebarCollapsed;
      
      if (recordsSidebarCollapsed) {
        sidebar.classList.add('collapsed');
        sidebar.classList.remove('expanded');
        mainContent.classList.add('full-width');
        toggleIcon.textContent = 'â€º';
      } else {
        sidebar.classList.remove('collapsed');
        sidebar.classList.add('expanded');
        mainContent.classList.remove('full-width');
        toggleIcon.textContent = 'â€¹';
      }
    }
    
    function openRecordsSidebar() {
      if (recordsSidebarCollapsed) {
        toggleRecordsSidebar();
      }
    }

    // ========== åˆ—è¡¨è§†å›¾ç­›é€‰åŠŸèƒ½ ==========
    const filterRecords = debounce(function() {
      const searchText = document.getElementById('searchInput').value.toLowerCase();
      const projectFilter = document.getElementById('projectFilter').value;
      const tagFilter = document.getElementById('tagFilter').value;
      
      let filtered = [...records];

      // æœç´¢æ–‡æœ¬ç­›é€‰
      if (searchText) {
        filtered = filtered.filter(r => 
          r.title.toLowerCase().includes(searchText) || 
          r.content.toLowerCase().includes(searchText) ||
          (r.tags && r.tags.some(tagId => {
            const tag = tags.find(t => t.id.toString() === tagId);
            return tag && tag.name.toLowerCase().includes(searchText);
          }))
        );
      }

      // é¡¹ç›®ç­›é€‰
      if (projectFilter) {
        filtered = filtered.filter(r => r.projectId === projectFilter);
      }

      // æ ‡ç­¾ç­›é€‰
      if (tagFilter) {
        filtered = filtered.filter(r => r.tags && r.tags.includes(tagFilter));
      }

      // æŒ‰æ—¶é—´å€’åºæ’åº
      filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      renderSidebarRecords(filtered);
    });

    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('projectFilter').value = '';
      document.getElementById('tagFilter').value = '';
      filterRecords();
      showToast('ç­›é€‰æ¡ä»¶å·²é‡ç½®', 'info');
    }
    
    function performSearch() {
      // æ‰§è¡Œæœç´¢
      filterRecords();
    }
    
    function filterRecordsByDate(date) {
      const dateStr = date.toDateString();
      const filtered = records.filter(r => new Date(r.date).toDateString() === dateStr);
      filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
      renderSidebarRecords(filtered);
      
      // æ˜¾ç¤ºæç¤ºä¿¡æ¯
      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      showToast(`${year}å¹´${month}æœˆ${day}æ—¥çš„è®°å½• (${filtered.length}æ¡)`, 'info');
    }

    function renderSidebarRecords(list = records) {
      const box = document.getElementById('sidebarRecordList');
      
      if (list.length === 0) {
        box.innerHTML = `
          <div class="empty-state">
            <div>ğŸ“­</div>
            <h4>æš‚æ— è®°å½•</h4>
            <p>ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ è®°å½•"æŒ‰é’®åˆ›å»ºç¬¬ä¸€æ¡å·¥ä½œè®°å½•å§</p>
          </div>
        `;
        return;
      }

      box.innerHTML = '';
      list.forEach(r => {
        const project = projects.find(p => p.id === r.projectId);
        const projectName = project ? project.name : 'æœªåˆ†ç±»';
        
        const tagNames = (r.tags || []).map(tagId => {
          const tag = tags.find(t => t.id.toString() === tagId);
          return tag ? tag.name : '';
        }).filter(name => name);
        
        const div = document.createElement('div');
        div.className = 'record';
        
        const createTime = new Date(r.date).toLocaleString('zh-CN', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const updateTime = r.updateTime ? new Date(r.updateTime).toLocaleString('zh-CN', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        }) : '';
        
        let filesHtml = '';
        if (r.files && r.files.length > 0) {
          filesHtml = `<div style="margin:10px 0;">
            <strong>é™„ä»¶ (${r.files.length})ï¼š</strong>
            <div class="file-preview" style="margin-top:5px;">`;
          
          r.files.forEach(file => {
            let filePreview = '';
            if (file.type.startsWith('image/')) {
              filePreview = `<img src="${file.data}" alt="${file.name}" style="max-width:80px; max-height:80px; cursor:pointer;" onclick="openImageViewer('${file.data}')" />`;
            } else {
              filePreview = `<div style="width:80px; height:80px; border:1px solid #eee; display:flex; align-items:center; justify-content:center; font-size:24px; cursor:pointer;" onclick="downloadFile('${file.data}', '${file.name}')">ğŸ“„</div>`;
            }
            
            filesHtml += `
              <div style="text-align:center;">
                ${filePreview}
                <div style="font-size:10px; margin-top:5px;">${file.name}</div>
              </div>
            `;
          });
          
          filesHtml += `</div></div>`;
        }
        
        div.innerHTML = `
          <h4>
            ${r.title}
            <span style="font-size: 12px; font-weight: normal; color: #7f8c8d;">
              ${new Date(r.date).toLocaleDateString()}
            </span>
          </h4>
          <div class="record-meta">
            <span class="tag tag-project">${projectName}</span>
            ${tagNames.map(t => `<span class="tag">${t}</span>`).join('')}
          </div>
          <div style="margin:10px 0; color:#555; line-height: 1.8;">
            ${r.content ? r.content.substring(0, 100) + (r.content.length > 100 ? '...' : '') : '<span style="color:#999;">æ— å†…å®¹</span>'}
          </div>
          ${filesHtml}
          <div class="record-meta">
            <span>åˆ›å»ºæ—¶é—´: ${createTime}</span>
            ${updateTime ? `<span>æ›´æ–°æ—¶é—´: ${updateTime}</span>` : ''}
          </div>
          <div style="margin-top:15px;">
            <button class="btn btn-primary" onclick="editRecord(${r.id})">
              <span>âœï¸</span> ç¼–è¾‘
            </button>
            <button class="btn btn-danger" onclick="deleteRecord(${r.id})">
              <span>ğŸ—‘ï¸</span> åˆ é™¤
            </button>
          </div>
        `;
        
        box.appendChild(div);
      });
    }

    function downloadFile(dataUrl, fileName) {
      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    // ========== æ—¥å†è§†å›¾åŠŸèƒ½ ==========
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      // æ›´æ–°æ—¥å†æ ‡é¢˜
      document.getElementById('calendarTitle').textContent = `${year}å¹´${month + 1}æœˆ`;
      
      const grid = document.getElementById('calendarGrid');
      grid.innerHTML = '';
      
      // æ·»åŠ æ˜ŸæœŸæ ‡é¢˜
      const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
      weekdays.forEach(day => {
        const weekdayDiv = document.createElement('div');
        weekdayDiv.className = 'calendar-weekday';
        weekdayDiv.textContent = day;
        grid.appendChild(weekdayDiv);
      });
      
      // è·å–å½“æœˆç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      
      // è·å–å½“æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ 
      const firstDayWeekday = firstDay.getDay();
      
      // è·å–ä¸Šä¸ªæœˆçš„æœ€åå‡ å¤©
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      
      // ç”Ÿæˆæ—¥å†æ ¼å­
      let dayCount = 1;
      let nextMonthDayCount = 1;
      
      for (let i = 0; i < 42; i++) { // 6è¡Œ7åˆ—
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        
        let currentDay;
        let isCurrentMonth = true;
        
        if (i < firstDayWeekday) {
          // ä¸Šä¸ªæœˆçš„æ—¥æœŸ
          currentDay = prevMonthLastDay - (firstDayWeekday - i - 1);
          dayDiv.classList.add('other-month');
          isCurrentMonth = false;
        } else if (i >= firstDayWeekday + lastDay.getDate()) {
          // ä¸‹ä¸ªæœˆçš„æ—¥æœŸ
          currentDay = nextMonthDayCount++;
          dayDiv.classList.add('other-month');
          isCurrentMonth = false;
        } else {
          // å½“å‰æœˆçš„æ—¥æœŸ
          currentDay = dayCount++;
        }
        
        // åˆ›å»ºæ—¥æœŸæ•°å­—
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = currentDay;
        
        // è·å–å®Œæ•´æ—¥æœŸ
        const fullDate = new Date(isCurrentMonth ? year : (i < firstDayWeekday ? year : year + 1), 
                                isCurrentMonth ? month : (i < firstDayWeekday ? month - 1 : month + 1), 
                                currentDay);
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯ä»Šå¤©
        const today = new Date();
        if (fullDate.toDateString() === today.toDateString()) {
          dayDiv.classList.add('today');
        }
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯é€‰ä¸­çš„æ—¥æœŸ
        if (fullDate.toDateString() === selectedDate.toDateString()) {
          dayDiv.classList.add('selected');
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰è®°å½•
        const dayRecords = getRecordsForDate(fullDate);
        if (dayRecords.length > 0) {
          dayDiv.classList.add('has-records');
          
          const recordCount = document.createElement('div');
          recordCount.className = 'day-record-count';
          recordCount.textContent = dayRecords.length;
          dayDiv.appendChild(recordCount);
        }
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        dayDiv.addEventListener('click', () => {
          selectedDate = new Date(fullDate);
          renderCalendar(); // é‡æ–°æ¸²æŸ“æ—¥å†ä»¥æ›´æ–°é€‰ä¸­çŠ¶æ€
          
          // è‡ªåŠ¨æ‰“å¼€ä¾§è¾¹æ å¹¶æ˜¾ç¤ºè¯¥æ—¥æœŸçš„è®°å½•
          openRecordsSidebar();
          filterRecordsByDate(selectedDate);
          
          // æ·»åŠ ç‚¹å‡»è§†è§‰åé¦ˆ
          dayDiv.style.transform = 'scale(0.95)';
          setTimeout(() => {
            dayDiv.style.transform = '';
          }, 100);
        });
        
        dayDiv.appendChild(dayNumber);
        grid.appendChild(dayDiv);
      }
    }

    function changeMonth(direction) {
      currentDate.setMonth(currentDate.getMonth() + direction);
      renderCalendar();
    }

    function goToToday() {
      currentDate = new Date();
      selectedDate = new Date();
      renderCalendar();
      renderSelectedDateRecords();
    }

    function getRecordsForDate(date) {
      const dateStr = date.toDateString();
      return records.filter(r => new Date(r.date).toDateString() === dateStr);
    }

    function renderSelectedDateRecords() {
      const title = document.getElementById('selectedDateTitle');
      const recordsContainer = document.getElementById('selectedDateRecords');
      
      // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
      const year = selectedDate.getFullYear();
      const month = selectedDate.getMonth() + 1;
      const day = selectedDate.getDate();
      title.textContent = `${year}å¹´${month}æœˆ${day}æ—¥çš„è®°å½•`;
      
      // è·å–é€‰ä¸­æ—¥æœŸçš„è®°å½•
      const dayRecords = getRecordsForDate(selectedDate);
      
      if (dayRecords.length === 0) {
        recordsContainer.innerHTML = `
          <div class="empty-state">
            <div>ğŸ“­</div>
            <h4>æš‚æ— è®°å½•</h4>
            <p>ç‚¹å‡»"æ·»åŠ è®°å½•"æŒ‰é’®åˆ›å»ºè¯¥æ—¥æœŸçš„ç¬¬ä¸€æ¡å·¥ä½œè®°å½•å§</p>
          </div>
        `;
        return;
      }
      
      // æŒ‰æ—¶é—´å€’åºæ’åº
      dayRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      recordsContainer.innerHTML = '';
      dayRecords.forEach(r => {
        const project = projects.find(p => p.id === r.projectId);
        const projectName = project ? project.name : 'æœªåˆ†ç±»';
        
        const tagNames = (r.tags || []).map(tagId => {
          const tag = tags.find(t => t.id.toString() === tagId);
          return tag ? tag.name : '';
        }).filter(name => name);
        
        const div = document.createElement('div');
        div.className = 'record';
        
        const createTime = new Date(r.date).toLocaleString('zh-CN', {
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const updateTime = r.updateTime ? new Date(r.updateTime).toLocaleString('zh-CN', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        }) : '';
        
        let filesHtml = '';
        if (r.files && r.files.length > 0) {
          filesHtml = `<div style="margin:10px 0;">
            <strong>é™„ä»¶ (${r.files.length})ï¼š</strong>
            <div class="file-preview" style="margin-top:5px;">`;
          
          r.files.forEach(file => {
            let filePreview = '';
            if (file.type.startsWith('image/')) {
              filePreview = `<img src="${file.data}" alt="${file.name}" style="max-width:80px; max-height:80px; cursor:pointer;" onclick="openImageViewer('${file.data}')" />`;
            } else {
              filePreview = `<div style="width:80px; height:80px; border:1px solid #eee; display:flex; align-items:center; justify-content:center; font-size:24px; cursor:pointer;" onclick="downloadFile('${file.data}', '${file.name}')">ğŸ“„</div>`;
            }
            
            filesHtml += `
              <div style="text-align:center;">
                ${filePreview}
                <div style="font-size:10px; margin-top:5px;">${file.name}</div>
              </div>
            `;
          });
          
          filesHtml += `</div></div>`;
        }
        
        div.innerHTML = `
          <h4>
            ${r.title}
            <span style="font-size: 12px; font-weight: normal; color: #7f8c8d;">
              ${createTime}
            </span>
          </h4>
          <div class="record-meta">
            <span class="tag tag-project">${projectName}</span>
            ${tagNames.map(t => `<span class="tag">${t}</span>`).join('')}
          </div>
          <div style="margin:10px 0; color:#555; line-height: 1.8;">
            ${r.content || '<span style="color:#999;">æ— å†…å®¹</span>'}
          </div>
          ${filesHtml}
          ${updateTime ? `<div class="record-meta"><span>æ›´æ–°æ—¶é—´: ${updateTime}</span></div>` : ''}
          <div style="margin-top:15px;">
            <button class="btn btn-primary" onclick="editRecord(${r.id})">
              <span>âœï¸</span> ç¼–è¾‘
            </button>
            <button class="btn btn-danger" onclick="deleteRecord(${r.id})">
              <span>ğŸ—‘ï¸</span> åˆ é™¤
            </button>
          </div>
        `;
        
        recordsContainer.appendChild(div);
      });
    }

    // ========== æ¨¡æ€æ¡†ç®¡ç† ==========
    function closeModal() {
      document.getElementById('editModal').style.display = 'none';
      document.getElementById('addRecordModal').style.display = 'none';
      document.getElementById('projectModal').style.display = 'none';
      document.getElementById('tagModal').style.display = 'none';
      document.getElementById('githubModal').style.display = 'none';
      
      editUploadedFiles = [];
      addDateUploadedFiles = [];
    }

    // ========== GitHub åŠŸèƒ½ï¼ˆè‡ªåŠ¨åŒæ­¥ï¼‰ ==========
    function openGitHubSettings() {
      document.getElementById('githubModal').style.display = 'flex';
    }

    function loadGitHubConfig() {
      document.getElementById('githubOwner').value = githubConfig.owner || '';
      document.getElementById('githubRepo').value = githubConfig.repo || '';
      document.getElementById('githubToken').value = githubConfig.token || '';
      document.getElementById('autoSyncToggle').checked = githubConfig.autoSync === true;
      document.getElementById('autoPullToggle').checked = githubConfig.autoPull === true;
    }

    function saveGitHubConfig() {
      const owner = document.getElementById('githubOwner').value.trim();
      const repo = document.getElementById('githubRepo').value.trim();
      const token = document.getElementById('githubToken').value.trim();
      const autoSync = document.getElementById('autoSyncToggle').checked;
      const autoPull = document.getElementById('autoPullToggle').checked;
      
      if (!owner || !repo || !token) {
        showToast('è¯·å¡«å†™å®Œæ•´çš„GitHubé…ç½®ä¿¡æ¯ï¼', 'error');
        return;
      }
      
      githubConfig = { owner, repo, token, autoSync, autoPull };
      localStorage.setItem('githubConfig', JSON.stringify(githubConfig));
      
      checkAutoSyncSettings();
      
      closeModal();
      showToast('GitHubé…ç½®å·²ä¿å­˜ï¼', 'success');
    }

    function checkAutoSyncSettings() {
      if (autoSyncInterval) {
        clearInterval(autoSyncInterval);
        autoSyncInterval = null;
      }
      
      if (githubConfig.autoSync === true && githubConfig.owner && githubConfig.repo && githubConfig.token) {
        autoSyncInterval = setInterval(() => {
          syncToGitHub(true);
        }, AUTO_SYNC_INTERVAL);
        
        showToast('è‡ªåŠ¨åŒæ­¥å·²å¯ç”¨ï¼ˆæ¯30åˆ†é’Ÿï¼‰', 'info');
      }
    }

    async function syncToGitHub(silent = false) {
      if (!silent) {
        const syncBtn = document.getElementById('syncBtn');
        syncBtn.disabled = true;
        syncBtn.innerHTML = '<span class="loader"></span> åŒæ­¥ä¸­...';
      }
      
      try {
        if (!githubConfig.owner || !githubConfig.repo || !githubConfig.token) {
          if (!silent) showToast('è¯·å…ˆé…ç½® GitHub è®¾ç½®ï¼', 'error');
          return;
        }

        const syncData = {
          records,
          projects,
          tags,
          syncTime: new Date().toISOString(),
          version: '2.1.0'
        };

        const content = btoa(unescape(encodeURIComponent(JSON.stringify(syncData, null, 2))));
        const path = 'worklog_backup.json';
        const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${path}`;

        let sha = undefined;
        const res = await fetch(url);
        if (res.ok) {
          const data = await res.json();
          sha = data.sha;
        }

        const response = await fetch(url, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `token ${githubConfig.token}`
          },
          body: JSON.stringify({
            message: `Work log backup - ${new Date().toLocaleString()}`,
            content,
            sha
          })
        });

        if (response.ok) {
          if (!silent) showToast('âœ… åŒæ­¥åˆ°GitHubæˆåŠŸï¼', 'success');
        } else {
          const error = await response.json();
          if (!silent) showToast(`âŒ åŒæ­¥å¤±è´¥ï¼š${error.message}`, 'error');
        }
      } catch (error) {
        if (!silent) showToast(`âŒ åŒæ­¥å‡ºé”™ï¼š${error.message}`, 'error');
      } finally {
        if (!silent) {
          const syncBtn = document.getElementById('syncBtn');
          syncBtn.disabled = false;
          syncBtn.innerHTML = '<span>â˜ï¸</span> åŒæ­¥åˆ°GitHub';
        }
      }
    }

    async function syncFromGitHub(silent = false) {
      if (!silent) {
        const pullBtn = document.getElementById('pullBtn');
        pullBtn.disabled = true;
        pullBtn.innerHTML = '<span class="loader"></span> æ›´æ–°ä¸­...';
      }
      
      try {
        if (!githubConfig.owner || !githubConfig.repo || !githubConfig.token) {
          if (!silent) showToast('è¯·å…ˆé…ç½® GitHub è®¾ç½®ï¼', 'error');
          return;
        }

        const path = 'worklog_backup.json';
        const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${path}`;

        const response = await fetch(url, {
          headers: {
            'Authorization': `token ${githubConfig.token}`
          }
        });

        if (!response.ok) {
          if (!silent) showToast('âŒ æœªæ‰¾åˆ°å¤‡ä»½æ–‡ä»¶', 'error');
          return;
        }

        const data = await response.json();
        const content = decodeURIComponent(escape(atob(data.content)));
        const syncData = JSON.parse(content);

        if (!syncData.records || !Array.isArray(syncData.records)) {
          if (!silent) showToast('âŒ å¤‡ä»½æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®', 'error');
          return;
        }
        
        if (!silent && !confirm('âš ï¸ ä»GitHubæ›´æ–°ä¼šè¦†ç›–æœ¬åœ°æ•°æ®ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
          return;
        }

        records = syncData.records || [];
        projects = syncData.projects || [];
        tags = syncData.tags || [];
        
        saveRecords();
        saveProjects();
        saveTags();
        renderProjects();
        renderTags();
        render();
        
        // å¦‚æœåœ¨æ—¥å†è§†å›¾ä¸­ï¼Œæ›´æ–°æ—¥å†å’Œé€‰ä¸­æ—¥æœŸçš„è®°å½•
        if (currentView === 'calendar') {
          renderCalendar();
          renderSelectedDateRecords();
        }
        
        if (!silent) showToast('âœ… ä»GitHubæ›´æ–°æˆåŠŸï¼', 'success');
      } catch (error) {
        if (!silent) showToast(`âŒ æ›´æ–°å‡ºé”™ï¼š${error.message}`, 'error');
      } finally {
        if (!silent) {
          const pullBtn = document.getElementById('pullBtn');
          pullBtn.disabled = false;
          pullBtn.innerHTML = '<span>â¬‡ï¸</span> ä»GitHubæ›´æ–°';
        }
      }
    }

    // ========== æœ¬åœ°å¯¼å…¥å¯¼å‡º ==========
    function exportLocal() {
      try {
        const exportData = {
          records,
          projects,
          tags,
          exportTime: new Date().toISOString(),
          version: '2.1.0'
        };

        const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g, '');
        a.download = `Work-logå¤‡ä»½_${dateStr}.json`;
        
        a.click();
        URL.revokeObjectURL(a.href);
        showToast('å¯¼å‡ºæˆåŠŸï¼', 'success');
      } catch (error) {
        showToast('å¯¼å‡ºå¤±è´¥ï¼š' + error.message, 'error');
      }
    }

    function importLocal() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      
      input.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;
        
        if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
          showToast('è¯·é€‰æ‹©JSONæ ¼å¼çš„å¤‡ä»½æ–‡ä»¶ï¼', 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const importedData = JSON.parse(reader.result);
            
            if (!importedData.records || !Array.isArray(importedData.records)) {
              showToast('å¤‡ä»½æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼', 'error');
              return;
            }
            
            if (confirm('âš ï¸ å¯¼å…¥ä¼šè¦†ç›–ç°æœ‰æ•°æ®ï¼Œç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
              records = importedData.records || [];
              projects = importedData.projects || [];
              tags = importedData.tags || [];
              
              saveRecords();
              saveProjects();
              saveTags();
              renderProjects();
              renderTags();
              render();
              
              // å¦‚æœåœ¨æ—¥å†è§†å›¾ä¸­ï¼Œæ›´æ–°æ—¥å†å’Œé€‰ä¸­æ—¥æœŸçš„è®°å½•
              if (currentView === 'calendar') {
                renderCalendar();
                renderSelectedDateRecords();
              }
              
              showToast('âœ… å¯¼å…¥æˆåŠŸï¼', 'success');
            }
          } catch (error) {
            showToast(`âŒ å¯¼å…¥å¤±è´¥ï¼š${error.message}`, 'error');
          }
        };
        
        reader.readAsText(file);
      };
      
      input.click();
    }
  </script>

</body>
</html>
