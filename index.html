<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作记录</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.544.0/dist/umd/lucide.min.js"></script>
    <style>
        :root {
            --primary-color: #4F46E5;
            --secondary-color: #EC4899;
            --background-color: #F3F4F6;
            --card-background: #FFFFFF;
            --text-color: #1F2937;
            --sidebar-background: #1F2937;
            --sidebar-text: #D1D5DB;
            --sidebar-active-text: #FFFFFF;
        }
        .dark {
            --primary-color: #6366F1;
            --secondary-color: #F472B6;
            --background-color: #111827;
            --card-background: #1F2937;
            --text-color: #F9FAFB;
            --sidebar-background: #000000;
            --sidebar-text: #9CA3AF;
            --sidebar-active-text: #FFFFFF;
        }
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
        }
        .sidebar {
            background-color: var(--sidebar-background);
            color: var(--sidebar-text);
        }
        .sidebar a {
            color: var(--sidebar-text);
        }
        .sidebar a.active, .sidebar a:hover {
            background-color: var(--primary-color);
            color: var(--sidebar-active-text);
        }
        .card {
            background-color: var(--card-background);
        }
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }
        .modal {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: var(--card-background);
        }
    </style>
</head>
<body class="flex h-screen">
    <aside class="sidebar w-64 flex-shrink-0 p-4 space-y-4">
        <div class="text-white text-2xl font-bold">工作记录</div>
        <nav class="space-y-2">
            <a href="#" class="flex items-center p-2 rounded-lg active" data-view="all">
                <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i>
                全部记录
            </a>
            <a href="#" class="flex items-center p-2 rounded-lg" data-view="today">
                <i data-lucide="calendar-today" class="w-5 h-5 mr-3"></i>
                今天
            </a>
            <a href="#" class="flex items-center p-2 rounded-lg" data-view="week">
                <i data-lucide="calendar-week" class="w-5 h-5 mr-3"></i>
                本周
            </a>
            <a href="#" class="flex items-center p-2 rounded-lg" data-view="categories">
                <i data-lucide="folder" class="w-5 h-5 mr-3"></i>
                项目分类
            </a>
            <a href="#" class="flex items-center p-2 rounded-lg" data-view="tags">
                <i data-lucide="tags" class="w-5 h-5 mr-3"></i>
                标签
            </a>
        </nav>
        <div class="absolute bottom-4 left-4">
            <a href="#" class="flex items-center p-2 rounded-lg" id="github-settings-btn">
                <i data-lucide="github" class="w-5 h-5 mr-3"></i>
                GitHub 设置
            </a>
            <button class="flex items-center p-2 rounded-lg mt-2" id="theme-toggle">
                <i data-lucide="sun" class="w-5 h-5 mr-3" id="theme-icon"></i>
                <span id="theme-text">浅色模式</span>
            </button>
        </div>
    </aside>

    <main class="flex-1 p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-bold" id="page-title">全部记录</h1>
            <div class="flex items-center space-x-4">
                <div class="relative">
                    <input type="text" id="search-input" placeholder="搜索记录..." class="pl-10 pr-4 py-2 rounded-lg border focus:ring-primary-color focus:border-primary-color">
                    <i data-lucide="search" class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                </div>
                <button class="btn-primary px-4 py-2 rounded-lg flex items-center" id="add-record-btn">
                    <i data-lucide="plus" class="w-5 h-5 mr-2"></i>
                    添加记录
                </button>
                <button class="btn-secondary px-4 py-2 rounded-lg flex items-center" id="sync-github-btn">
                    <i data-lucide="sync" class="w-5 h-5 mr-2"></i>
                    同步到 GitHub
                </button>
            </div>
        </div>

        <div id="content-area">
            <!-- 记录将在这里动态生成 -->
        </div>
    </main>

    <!-- 添加/编辑记录模态框 -->
    <div id="record-modal" class="modal fixed inset-0 z-50 hidden items-center justify-center">
        <div class="modal-content p-8 rounded-lg shadow-lg w-1/3">
            <h2 class="text-2xl font-bold mb-4" id="modal-title">添加记录</h2>
            <form id="record-form">
                <input type="hidden" id="record-id">
                <div class="mb-4">
                    <label for="record-title" class="block text-sm font-medium mb-2">标题</label>
                    <input type="text" id="record-title" class="w-full p-2 border rounded-lg" required>
                </div>
                <div class="mb-4">
                    <label for="record-content" class="block text-sm font-medium mb-2">内容</label>
                    <textarea id="record-content" rows="4" class="w-full p-2 border rounded-lg" required></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label for="record-category" class="block text-sm font-medium mb-2">项目分类</label>
                        <input type="text" id="record-category" class="w-full p-2 border rounded-lg">
                    </div>
                    <div>
                        <label for="record-tags" class="block text-sm font-medium mb-2">标签 (用逗号分隔)</label>
                        <input type="text" id="record-tags" class="w-full p-2 border rounded-lg">
                    </div>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" class="px-4 py-2 rounded-lg" id="cancel-record-btn">取消</button>
                    <button type="submit" class="btn-primary px-4 py-2 rounded-lg">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- GitHub 设置模态框 -->
    <div id="github-modal" class="modal fixed inset-0 z-50 hidden items-center justify-center">
        <div class="modal-content p-8 rounded-lg shadow-lg w-1/3">
            <h2 class="text-2xl font-bold mb-4">GitHub 设置</h2>
            <form id="github-form">
                <div class="mb-4">
                    <label for="github-owner" class="block text-sm font-medium mb-2">仓库所有者</label>
                    <input type="text" id="github-owner" class="w-full p-2 border rounded-lg">
                </div>
                <div class="mb-4">
                    <label for="github-repo" class="block text-sm font-medium mb-2">仓库名称</label>
                    <input type="text" id="github-repo" class="w-full p-2 border rounded-lg">
                </div>
                <div class="mb-4">
                    <label for="github-token" class="block text-sm font-medium mb-2">Personal Access Token</label>
                    <input type="password" id="github-token" class="w-full p-2 border rounded-lg">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" class="px-4 py-2 rounded-lg" id="cancel-github-btn">取消</button>
                    <button type="submit" class="btn-primary px-4 py-2 rounded-lg">保存</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        lucide.createIcons();

        const records = [
            {
                id: 1,
                title: "完成了首页的设计",
                content: "今天完成了个人工作记录网站的首页设计，包括布局、配色和响应式设计。",
                category: "Web开发",
                tags: ["设计", "前端"],
                date: new Date().toISOString()
            },
            {
                id: 2,
                title: "学习了 Tailwind CSS",
                content: "学习了 Tailwind CSS 的基本用法，包括如何使用工具类来快速构建 UI。",
                category: "学习",
                tags: ["CSS", "前端"],
                date: new Date(Date.now() - 86400000).toISOString() // 昨天
            }
        ];

        let currentView = 'all';
        let searchTerm = '';

        const contentArea = document.getElementById('content-area');
        const pageTitle = document.getElementById('page-title');
        const searchInput = document.getElementById('search-input');
        const addRecordBtn = document.getElementById('add-record-btn');
        const syncGithubBtn = document.getElementById('sync-github-btn');
        const recordModal = document.getElementById('record-modal');
        const modalTitle = document.getElementById('modal-title');
        const recordForm = document.getElementById('record-form');
        const recordId = document.getElementById('record-id');
        const recordTitle = document.getElementById('record-title');
        const recordContent = document.getElementById('record-content');
        const recordCategory = document.getElementById('record-category');
        const recordTags = document.getElementById('record-tags');
        const cancelRecordBtn = document.getElementById('cancel-record-btn');
        const githubSettingsBtn = document.getElementById('github-settings-btn');
        const githubModal = document.getElementById('github-modal');
        const githubForm = document.getElementById('github-form');
        const githubOwner = document.getElementById('github-owner');
        const githubRepo = document.getElementById('github-repo');
        const githubToken = document.getElementById('github-token');
        const cancelGithubBtn = document.getElementById('cancel-github-btn');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');

        function renderRecords() {
            let filteredRecords = [...records];

            if (searchTerm) {
                filteredRecords = filteredRecords.filter(record => 
                    record.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    record.content.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    record.category.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    record.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))
                );
            }

            if (currentView === 'today') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                filteredRecords = filteredRecords.filter(record => new Date(record.date) >= today);
            } else if (currentView === 'week') {
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                filteredRecords = filteredRecords.filter(record => new Date(record.date) >= weekAgo);
            }

            contentArea.innerHTML = '';

            if (filteredRecords.length === 0) {
                contentArea.innerHTML = `
                    <div class="text-center py-12">
                        <i data-lucide="file-text" class="w-16 h-16 mx-auto text-gray-400"></i>
                        <p class="mt-4 text-gray-500">暂无记录</p>
                        <button class="btn-primary mt-4 px-4 py-2 rounded-lg" id="add-first-record-btn">添加第一条记录</button>
                    </div>
                `;
                lucide.createIcons();
                document.getElementById('add-first-record-btn').addEventListener('click', () => {
                    openRecordModal();
                });
                return;
            }

            filteredRecords.forEach(record => {
                const recordElement = document.createElement('div');
                recordElement.className = 'card p-6 rounded-lg shadow-md mb-4';
                recordElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-xl font-bold">${record.title}</h3>
                            <p class="text-gray-600 dark:text-gray-400 mt-2">${record.content}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button class="text-gray-400 hover:text-primary-color edit-record-btn" data-id="${record.id}">
                                <i data-lucide="edit" class="w-5 h-5"></i>
                            </button>
                            <button class="text-gray-400 hover:text-red-500 delete-record-btn" data-id="${record.id}">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 flex flex-wrap items-center gap-2">
                        <span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">${record.category}</span>
                        ${record.tags.map(tag => `<span class="bg-gray-100 text-gray-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-gray-700 dark:text-gray-300">${tag}</span>`).join('')}
                    </div>
                    <div class="mt-4 text-sm text-gray-500">${new Date(record.date).toLocaleString()}</div>
                `;
                contentArea.appendChild(recordElement);
            });

            lucide.createIcons();

            document.querySelectorAll('.edit-record-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    openRecordModal(id);
                });
            });

            document.querySelectorAll('.delete-record-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.dataset.id;
                    deleteRecord(id);
                });
            });
        }

        function openRecordModal(id = null) {
            if (id) {
                const record = records.find(r => r.id == id);
                modalTitle.textContent = '编辑记录';
                recordId.value = record.id;
                recordTitle.value = record.title;
                recordContent.value = record.content;
                recordCategory.value = record.category;
                recordTags.value = record.tags.join(', ');
            } else {
                modalTitle.textContent = '添加记录';
                recordId.value = '';
                recordTitle.value = '';
                recordContent.value = '';
                recordCategory.value = '';
                recordTags.value = '';
            }
            recordModal.classList.remove('hidden');
            recordModal.classList.add('flex');
        }

        function closeRecordModal() {
            recordModal.classList.add('hidden');
            recordModal.classList.remove('flex');
        }

        function saveRecord(e) {
            e.preventDefault();
            const id = recordId.value;
            const title = recordTitle.value;
            const content = recordContent.value;
            const category = recordCategory.value;
            const tags = recordTags.value.split(',').map(tag => tag.trim()).filter(tag => tag);

            if (id) {
                const record = records.find(r => r.id == id);
                record.title = title;
                record.content = content;
                record.category = category;
                record.tags = tags;
            } else {
                const newRecord = {
                    id: Date.now(),
                    title,
                    content,
                    category,
                    tags,
                    date: new Date().toISOString()
                };
                records.push(newRecord);
            }

            closeRecordModal();
            renderRecords();
        }

        function deleteRecord(id) {
            if (confirm('确定要删除这条记录吗？')) {
                const index = records.findIndex(r => r.id == id);
                if (index > -1) {
                    records.splice(index, 1);
                    renderRecords();
                }
            }
        }
        
        function syncToGithub() {
            // 模拟同步到 GitHub
            const syncBtn = document.getElementById('sync-github-btn');
            const originalText = syncBtn.innerHTML;
            syncBtn.disabled = true;
            syncBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 mr-2 animate-spin"></i> 同步中...';
            lucide.createIcons();

            setTimeout(() => {
                alert('同步成功！');
                syncBtn.disabled = false;
                syncBtn.innerHTML = originalText;
                lucide.createIcons();
            }, 1500);
        }

        function toggleTheme() {
            const body = document.body;
            const isDarkMode = body.classList.contains('dark');
            
            if (isDarkMode) {
                body.classList.remove('dark');
                themeIcon.setAttribute('data-lucide', 'moon');
                themeText.textContent = '深色模式';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark');
                themeIcon.setAttribute('data-lucide', 'sun');
                themeText.textContent = '浅色模式';
                localStorage.setItem('theme', 'dark');
            }
            lucide.createIcons();
        }


        // Event Listeners
        document.querySelectorAll('.sidebar nav a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.sidebar nav a').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                currentView = link.dataset.view;
                pageTitle.textContent = link.textContent.trim();
                renderRecords();
            });
        });

        searchInput.addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderRecords();
        });

        addRecordBtn.addEventListener('click', () => openRecordModal());
        recordForm.addEventListener('submit', saveRecord);
        cancelRecordBtn.addEventListener('click', closeRecordModal);
        syncGithubBtn.addEventListener('click', syncToGithub);
        themeToggle.addEventListener('click', toggleTheme);

        githubSettingsBtn.addEventListener('click', (e) => {
            e.preventDefault();
            githubModal.classList.remove('hidden');
            githubModal.classList.add('flex');
        });

        cancelGithubBtn.addEventListener('click', () => {
            githubModal.classList.add('hidden');
            githubModal.classList.remove('flex');
        });

        githubForm.addEventListener('submit', (e) => {
            e.preventDefault();
            // 保存 GitHub 设置
            const settings = {
                owner: githubOwner.value,
                repo: githubRepo.value,
                token: githubToken.value
            };
            localStorage.setItem('githubSettings', JSON.stringify(settings));
            githubModal.classList.add('hidden');
            githubModal.classList.remove('flex');
            alert('GitHub 设置已保存！');
        });

        // 初始化
        // 检查本地存储中的主题设置
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark');
            themeIcon.setAttribute('data-lucide', 'sun');
            themeText.textContent = '浅色模式';
        } else {
            themeIcon.setAttribute('data-lucide', 'moon');
            themeText.textContent = '深色模式';
        }

        // 检查本地存储中的 GitHub 设置
        const savedGithubSettings = localStorage.getItem('githubSettings');
        if (savedGithubSettings) {
            const settings = JSON.parse(savedGithubSettings);
            githubOwner.value = settings.owner;
            githubRepo.value = settings.repo;
            githubToken.value = settings.token;
        }

        renderRecords();
        lucide.createIcons();
    </script>
</body>
</html>
